;// bundle: Pages___Messages___1ba6a34618a2e94950d281400fab0595_m
;// files: modules/Pages/Messages.js

;// modules/Pages/Messages.js
Roblox.define("Pages.Messages",["Widgets.AvatarImage","jQuery","Resources.Messages"],function(n,t){function g(){return+new Date}function u(){}function lt(n){b=!1;var t=History.getState().data,e=i==r.Inbox?n:t.messagePage,o=i==r.Archive?n:t.archivePage,u=i==r.Sent?n:t.sentPage,f=i==r.Announcements?n:t.notificationsPage;History.pushState({archivePage:o,messagePage:e,sentPage:u,notificationsPage:f,tab:i},tt,"?"+i)}function ut(){i==undefined&&(i=r.Inbox);var n=History.getState().data;if(n.tab!=undefined&&n.messagePage!=undefined&&n.archivePage!=undefined&&n.sentPage!=undefined&&n.notificationsPage!=undefined){w(n);return}History.replaceState({archivePage:1,messagePage:1,sentPage:1,notificationsPage:1,tab:i},"ROBLOX - "+Resources.Messages.messages,"?"+i),i==r.Inbox?s(Roblox.MessagesPager,Roblox.MessagesPager.startIndex,-1):i==r.Archive?s(Roblox.ArchivedPager,Roblox.ArchivedPager.startIndex,-1):i==r.Sent?s(Roblox.SentPager,Roblox.SentPager.startIndex,-1):i==r.Notifications?s(Roblox.NotificationsPager,Roblox.NotificationsPager.startIndex,-1):Roblox.Widgets.AvatarImage.populate()}function ct(n,r,f,e,s,h){i=h,o=n,v=t("#ie7").length!=0;var c={Paging_PageNumbers_AreLinks:!1,FetchItemsOnLoad:!1,pagingClickFunction:lt};Roblox.MessagesPager=new DataPager(r,o,"MessagesInbox","pagingInbox",u,u,u,c),Roblox.ArchivedPager=new DataPager(f,o,"MessagesArchived","pagingArchived",u,u,u,c),Roblox.SentPager=new DataPager(e,o,"MessagesSent","pagingSent",u,u,u,c),Roblox.NotificationsPager=new DataPager(s,o,"MessagesSystem","pagingSystem",u,u,u,c),window.onpageshow=function(n){n.persisted&&window.location.reload()},ut()}function st(n){n?(t("#sent-general-buttons").hide(),t("#sent-detail-buttons").show(),t("#MessagesDetailSent").show(),t("#MessagesSent").hide()):(t("#sent-general-buttons").show(),t("#sent-detail-buttons").hide(),t("#MessagesDetailSent").hide(),t("#MessagesSent").show())}function ot(n){n?(t("#system-general-buttons").hide(),t("#system-detail-buttons").show(),t("#MessagesDetailSystem").show(),t("#MessagesSystem").hide()):(t("#system-general-buttons").show(),t("#system-detail-buttons").hide(),t("#MessagesDetailSystem").hide(),t("#MessagesSystem").show())}function et(n){n?(t("#inbox-general-buttons").hide(),t("#inbox-detail-buttons").show(),t("#MessagesDetailInbox").show(),t("#MessagesInbox").hide()):(t("#inbox-general-buttons").show(),t("#inbox-detail-buttons").hide(),t("#MessagesDetailInbox").hide(),t("#MessagesInbox").show())}function ht(n){n?(t("#archive-general-buttons").hide(),t("#archive-detail-buttons").show(),t("#MessagesDetailArchive").show(),t("#MessagesArchived").hide()):(t("#MessagesDetailArchive").hide(),t("#archive-general-buttons").show(),t("#archive-detail-buttons").hide(),t("#MessagesArchived").show())}function h(n,t){switch(n){case r.Archive:ht(t);break;case r.Inbox:et(t);break;case r.Sent:st(t);break;case r.Notifications:ot(t)}}function at(n,t){var i=null;switch(n){case r.Notifications:i={Pager:Roblox.NotificationsPager,PageNumber:t.notificationsPage};break;case r.Archive:i={Pager:Roblox.ArchivedPager,PageNumber:t.archivePage};break;case r.Sent:i={Pager:Roblox.SentPager,PageNumber:t.sentPage};break;case r.Inbox:i={Pager:Roblox.MessagesPager,PageNumber:t.messagePage}}return i}function w(n){var f,a;if(y){y=!1;return}if(f=i,h(f,!1),f=n.tab,c?(a="#ui-id-"+(parseInt(f)+1),t(a).click()):v&&(c=!0),v||(c=!0),f!=r.Announcements){var l=at(f,n),u=l.Pager,e=l.PageNumber,o=u.totalItems;u!==undefined&&(u.callUpdatePager(o,e),u.totalItems=o,e=u.getCurrentPage()),s(u,(e-1)*20+1,o)}}function s(n,r){r<0&&(r=0);var f="/getmessages",u={tab:i,startIndex:r?r-1:0,maxRows:o,cacheBuster:g()};t.ajax({type:"POST",data:u,url:f,dataType:"html",success:function(t){k(n,t)},error:function(){n.itemContainerDiv.html(d)}})}function p(n){switch(n){case r.Archive:return"#MessagesDetailArchive";case r.Sent:return"#MessagesDetailSent";case r.Notifications:return"#MessagesDetailSystem";default:return"#MessagesDetailInbox"}}function it(n){switch(n){case r.Archive:return"#MessagesArchived";case r.Sent:return"#MessagesSent";case r.Notifications:return"#MessagesSystem";default:return"#MessagesInbox"}}function nt(n,r){t("a.roblox-replyToMessage").removeClass("disabled");var f="/message/"+n,u=p(r);t(u).load(f,function(t,u){if(u!="error"){h(r,!0);var e=History.getState().data;y=!0,History.pushState({archivePage:e.archivePage||1,messagePage:e.messagePage||1,sentPage:e.sentPage||1,tab:i,messageId:n},"ROBLOX - "+Resources.Messages.messages,"?"+i)}});return}function ft(n){var f=p(n),u=it(n),r,i;h(n,!1),t(f).hide(),t(u).show(),r=History.getState().data,i="div[data-messageid="+r.messageId+"].messageDivider",t(i).removeClass("unread"),t(i).addClass("read")}function f(n,u,f){var c="/messages/changeMessageStatus?",h=u.getStartIndex()-1,e,y,v;if(f)c+="messageIds="+f;else{if(e=i==r.Inbox?t(l+":checked"):t(a+":checked"),y=i==r.Inbox?t(l):t(a),e.length==0)return!1;if((n==0||n==1)&&y.length==e.length&&u.isLastPage()&&h!=0){h=h-o;var s=History.getState().data,p=i!=r.Inbox?s.archivePage:s.archivePage-1,w=i!=r.Inbox?s.messagePage:s.messagePage-1;History.replaceState({archivePage:p||1,messagePage:w||1,tab:i},"ROBLOX - "+Resources.Messages.messages,"?"+i)}e.each(function(){var n=t(this).data("messageid");c+="messageIds="+n+"&"})}v={actionType:n,tab:i,startIndex:h,maxRows:o,cacheBuster:g()},t.ajax({type:"POST",data:v,url:c,dataType:"html",success:function(n){k(u,n)},error:function(){u.itemContainerDiv.html(d)}})}function k(n,u){var o,e,s,f;if(h(i),n.updateHtml(u),o=t("#tab"+i+"resultsTotal").val(),n.callUpdatePager(o),n.totalItems=o,e=[[".roblox-archiveButton",".roblox-markAsReadInbox",".roblox-markAsUnreadInbox"],[],[".roblox-moveToInboxButton",".roblox-markAsReadArchive",".roblox-markAsUnreadArchive"]],s=i==r.Inbox?".roblox-archiveAll":".roblox-moveAllToInbox",t(s).prop("checked",!1),o==0){for(f=0;f<e[i].length;f++)t(e[i][f]).addClass("disabled");t(s).attr("disabled",!0),n.itemContainerDiv.html(rt)}else{for(f=0;f<e[i].length;f++)t(e[i][f]).removeClass("disabled");t(s).removeAttr("disabled")}Roblox.Widgets.AvatarImage.populate()}var r={Inbox:0,Sent:1,Notifications:2,Archive:3,Announcements:4},e={MarkArchived:0,MarkUnarchived:1,MarkAsRead:2,MarkAsUnread:3,Delete:4},o,v,c=!0,d="<span class='singleMessage'>"+Resources.Messages.sorry+"</span>",rt="<span class='singleMessage'>"+Resources.Messages.noMessages+"</span>",tt="ROBLOX - Messages",y=!1,i=0,b=!1,l,a;t("#MessagesTabs").on("tabsactivate",function(n,t){var f=History.getState().data,u=t.newTab.data("name");u=="Sent"&&(i=r.Sent),u=="Notifications"&&(i=r.Notifications),u=="Inbox"&&(i=r.Inbox),u=="Archive"&&(i=r.Archive),u=="Announcements"&&(i=r.Announcements),b=!0,c=!1,History.pushState({archivePage:f.archivePage||1,messagePage:f.messagePage||1,sentPage:f.sentPage||1,notificationsPage:f.notificationsPage||1,tab:i},"ROBLOX -"+Resources.Messages.messages,"?"+i)});return l=".roblox-inboxCheckbox input[type=checkbox]",a=".roblox-archiveCheckbox input[type=checkbox]",t(".roblox-archiveAll").click(function(){t(l).prop("checked",this.checked)}),t(".roblox-moveAllToInbox").click(function(){t(a).prop("checked",this.checked)}),t(".roblox-markAsReadInbox").click(function(){f(e.MarkAsRead,Roblox.MessagesPager)}),t(".roblox-markAsUnreadInbox").click(function(){f(e.MarkAsUnread,Roblox.MessagesPager)}),t(".roblox-markAsReadArchive").click(function(){f(e.MarkAsRead,Roblox.ArchivedPager)}),t(".roblox-markAsUnreadArchive").click(function(){f(e.MarkAsUnread,Roblox.ArchivedPager)}),t(".roblox-moveToInboxButton").click(function(){f(e.MarkUnarchived,Roblox.ArchivedPager)}),t(".roblox-archiveButton").click(function(){f(e.MarkArchived,Roblox.MessagesPager)}),t(".roblox-archiveMessage").click(function(){var n=History.getState().data;f(e.MarkArchived,Roblox.MessagesPager,n.messageId)}),t(".roblox-moveToInboxMessage").click(function(){var n=History.getState().data;f(e.MarkUnarchived,Roblox.ArchivedPager,n.messageId)}),t(".roblox-deleteMessage").click(function(){var i=History.getState().data,n=t(this).hasClass("roblox-archived")?Roblox.ArchivedPager:Roblox.MessagesPager;f(e.Delete,n,i.messageId)}),t(".roblox-replyToMessage").click(function(){t(this).hasClass("disabled")||(t(".message-reply").show(),t(".messages-reply-box").focus(),t(this).addClass("disabled"))}),t(".roblox-messageback").click(function(){var n=History.getState().data;return ft(n.tab),!1}),t(".roblox-sendMessage").click(function(){var n=t(this).data("messageid"),r=t(".messages-reply-box[data-messageid="+n+"]").val(),i={body:r,inReplyToMessageId:n};t.ajax({type:"POST",data:i,url:url,dataType:"html"})}),t(".roblox-notificationRow").click(function(){var n=t(this).data("messageid"),r=t(".roblox-notificationMessage-"+n),i=r.css("display")!="none";i?t(".roblox-notificationMessage-"+n).slideUp("fast"):t(".roblox-notificationMessage-"+n).slideDown("fast")}),{init:ct,loadState:w,loadMessage:nt}});
